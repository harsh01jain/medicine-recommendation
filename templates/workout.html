<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workout Plans - CureWise</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <style>
    .footer {
      background-color: #F3F4F6;
      padding: 2rem 1rem;
      text-align: center;
      color: #4B5563;
    }
    :root {
      --primary-green: #22C55E;
      --background-mint: #F0FDF4;
      --text-dark: #111827;
      --text-gray: #6B7280;
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background-mint);
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      color: var(--primary-green);
      font-weight: bold;
      font-size: 1.25rem;
      text-decoration: none;
    }
    .main-content {
      background-image: url('static/workout.jpg');
      background-size: cover;
      background-position: center;
      flex-grow: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }
    .container {
      max-width: 720px;
      background-color: rgba(255,255,255,0.9);
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 2rem;
      position: relative;
    }
    /* Suggestions list styles */
    #suggestions {
      list-style: none;
      padding: 0;
      margin: 0;
      border: 1px solid #ccc;
      border-top: none;
      max-height: 150px;
      overflow-y: auto;
      background: #fff;
      width: 100%;
      z-index: 100;
      position: absolute;
      display: none;
    }
    #suggestions li {
      padding: 8px 12px;
      cursor: pointer;
    }
    #suggestions li:hover {
      background-color: #f0f0f0;
    }
    .info-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: rgba(255,255,255,0.7);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      font-size: 24px;
      color: #000;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .info-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    /* Highlight style for workout text */
    .highlight {
      color: var(--primary-green);
      font-size: 1.25rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header class="header">
    <a href="{{ url_for('index') }}" class="logo">
      <i class="fas fa-heartbeat me-2"></i> CureWise
    </a>
    <a href="{{ url_for('index') }}" class="btn btn-outline-primary">Back to Home</a>
  </header>
  <main class="main-content">
    <div class="container">
      <h1 class="mb-4 text-center">Workout Plans</h1>
      <p class="mb-4">At CureWise, we understand the importance of tailored exercise routines. Enter a health condition below to generate a customized workout plan.</p>
      <div class="card">
        <div class="card-body">
          <form id="workout-plan-form">
            <div class="mb-3 position-relative">
              <label for="disease-input" class="form-label">Health condition:</label>
              <input type="text" id="disease-input" class="form-control" placeholder="Search health condition..." autocomplete="off">
              <ul id="suggestions"></ul>
            </div>
            <button type="submit" class="btn btn-primary">Generate Workout Plan</button>
          </form>
          <div id="workout-result" class="mt-4"></div>
        </div>
      </div>
    </div>

  </main>

  <button class="info-button" onclick="showWarning()">i</button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // --- Auto-fill from Query Parameter ---
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }
    document.addEventListener("DOMContentLoaded", function() {
      const promptParam = getQueryParam("prompt");
      if (promptParam && promptParam.toLowerCase().startsWith("provide workout plan for")) {
        const parts = promptParam.split("for");
        if (parts.length > 1) {
          const conditionValue = parts[1].trim();
          const diseaseInput = document.getElementById("disease-input");
          if (diseaseInput) {
            diseaseInput.value = decodeURIComponent(conditionValue);
          }
        }
      }
    });

    // --- Suggestion List Functionality ---
    const diseases = [
      "vertigo (paroxysmal positional vertigo)",
      "amebiasis",
      "anemia",
      "arthritis",
      "ascariasis",
      "bronchial asthma",
      "candidiasis",
      "cervical spondylosis",
      "chickenpox",
      "chikungunya",
      "chronic cholestasis",
      "dengue",
      "diabetes",
      "dimorphic hemorrhoids (piles)",
      "drug reaction",
      "filariasis",
      "gastroenteritis",
      "gerd (gastroesophageal reflux disease)",
      "gonorrhea",
      "hepatitis a",
      "hepatitis e",
      "hookworm infection",
      "hypertension",
      "hyperthyroidism",
      "hypoglycemia",
      "hypothyroidism",
      "influenza",
      "jaundice",
      "leprosy",
      "malaria",
      "measles",
      "migraine",
      "mumps",
      "osteoarthritis",
      "peptic ulcer disease",
      "pneumonia",
      "psoriasis",
      "rubella",
      "scabies",
      "sinusitis",
      "syphilis",
      "tapeworm infection",
      "tetanus",
      "thalassemia",
      "toxoplasmosis",
      "trichomoniasis",
      "tuberculosis",
      "typhoid",
      "urinary tract infection",
      "yellow fever",
      "zika virus",
      "aids",
      "alcoholic hepatitis",
      "anthrax",
      "aplastic anemia",
      "black fungus (mucormycosis)",
      "bladder cancer",
      "bone cancer",
      "breast cancer",
      "cervical cancer",
      "chlamydia",
      "covid-19",
      "cysticercosis",
      "diphtheria",
      "ebola",
      "esophageal cancer",
      "g6pd deficiency",
      "heart attack",
      "hemophilia",
      "hepatitis b",
      "hepatitis c",
      "hepatitis d",
      "hodgkin's disease",
      "kidney cancer",
      "leukemia",
      "liver cancer",
      "lung cancer",
      "lymphoma",
      "non-hodgkin's lymphoma",
      "pancreatic cancer",
      "paralysis (brain hemorrhage)",
      "plague",
      "polio",
      "prostate cancer",
      "rabies",
      "sickle cell disease",
      "skin cancer",
      "stomach cancer",
      "thrombocytopenia",
      "urinary schistosomiasis",
      "acne",
      "allergic rhinitis",
      "athlete's foot",
      "boils",
      "canker sores",
      "conjunctivitis",
      "constipation",
      "corns and calluses",
      "dandruff",
      "dehydration",
      "dermatitis",
      "diarrhea",
      "ear infection",
      "flatulence",
      "food poisoning",
      "fungal infections",
      "gastritis",
      "hand, foot, and mouth disease",
      "heartburn",
      "heat rash",
      "hemorrhoids",
      "hives",
      "indigestion",
      "ingrown toenails",
      "jock itch",
      "lice infestation",
      "mild sunburn",
      "nasal congestion",
      "nosebleeds",
      "oral thrush",
      "pityriasis versicolor",
      "sore throat",
      "styes",
      "tooth decay",
      "warts"
    ];

    const diseaseInput = document.getElementById("disease-input");
const suggestionsList = document.getElementById("suggestions");

// Show suggestions when input is focused or typed in.
diseaseInput.addEventListener("focus", function() {
  showSuggestions(this.value.trim().toLowerCase());
});
diseaseInput.addEventListener("input", function(e) {
  const searchTerm = e.target.value.toLowerCase().trim();
  showSuggestions(searchTerm);
});

// Attach suggestion click handler only once.
suggestionsList.addEventListener("click", function(e) {
  if (e.target && e.target.nodeName === "LI") {
    diseaseInput.value = e.target.textContent;
    suggestionsList.style.display = "none";
  }
});

// Global click listener to hide suggestions when clicking outside.
document.addEventListener("click", function(e) {
  if (e.target !== diseaseInput && !suggestionsList.contains(e.target)) {
    suggestionsList.style.display = "none";
  }
});

// Display suggestions based on the search term.
function showSuggestions(searchTerm) {
  const filtered = diseases.filter(disease =>
    disease.toLowerCase().includes(searchTerm)
  );
  if (filtered.length === 0) {
    suggestionsList.innerHTML = "";
    suggestionsList.style.display = "none";
  } else {
    suggestionsList.innerHTML = filtered
      .map(item => `<li>${item}</li>`)
      .join("");
    suggestionsList.style.display = "block";
  }
}

// --- Function for Letter-by-Letter Typing Animation ---
function typeText(element, text, delay = 50) {
  let i = 0;
  element.innerHTML = "";
  let interval = setInterval(() => {
    element.innerHTML += text.charAt(i);
    i++;
    if (i >= text.length) {
      clearInterval(interval);
    }
  }, delay);
}

// --- Form Submission for Workout Plan ---
document.getElementById("workout-plan-form").addEventListener("submit", async function(e) {
  e.preventDefault();
  const userDisease = diseaseInput.value.trim();
  const resultDiv = document.getElementById("workout-result");

  if (!userDisease) {
    resultDiv.innerHTML = `<div class="alert alert-danger">Please enter a health condition.</div>`;
    return;
  }

  // Check if the entered condition is known (case-insensitive).
  const knownDisease = diseases.some(
    d => d.toLowerCase() === userDisease.toLowerCase()
  );

  if (knownDisease) {
    try {
      resultDiv.innerHTML = `
        <div class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="text-info mt-2">Loading workout plan...</p>
        </div>
      `;
      const response = await fetch("/disease/workout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ disease: userDisease.toLowerCase() })
      });
      const data = await response.json();
      if (!response.ok) {
        if (response.status === 403) {
          resultDiv.innerHTML = `<div class="alert alert-danger">Please log in to view workout information.</div>`;
          return;
        }
        throw new Error(data.error || "Failed to fetch workout information");
      }
      if (data.success && data.data) {
        const workoutInfo = data.data;
        resultDiv.innerHTML = `
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Workout Plan for ${workoutInfo.disease}</h4>
              <div class="workout-recommendations mt-3">
                <p id="animatedText">
                  The workout plan for ${workoutInfo.disease} is:
                  <span id="workoutText" class="highlight"></span>
                </p>
              </div>
              <p class="mt-3 text-muted fst-italic">
                <i class="fas fa-info-circle me-2"></i>
                Always consult with your doctor or a physical therapist before starting a new exercise program.
              </p>
            </div>
          </div>
        `;
        const workoutSpan = document.getElementById("workoutText");
        typeText(workoutSpan, workoutInfo.workout);
      } else {
        resultDiv.innerHTML = `<div class="alert alert-warning"><i class="fas fa-exclamation-triangle me-2"></i>No workout information available for this condition.</div>`;
      }
      showWarning();
    } catch (error) {
      console.error("Error:", error);
      resultDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i>Error: ${error.message}</div>`;
    }
  } else {
    // If the condition is not known, ask if the chatbot should generate a workout plan.
    if (confirm(`The condition "${userDisease}" is not in our list. Would you like the chatbot to generate a workout plan?`)) {
      window.location.href = "/chatbot?prompt=" + encodeURIComponent("Provide workout plan for " + userDisease);
    } else {
      resultDiv.innerHTML = "";
    }
  }
});

// Append additional styles for smooth card transitions.
const style = document.createElement("style");
style.textContent = `
  .card {
    transition: all 0.3s ease-in-out;
  }
  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15) !important;
  }
`;
document.head.appendChild(style);

// --- Example Info Button Function ---
function showWarning() {
  alert("Warning: The model and data are still under development. Please consult a healthcare professional before following any exercise advice.");
}

  </script>
</body>
</html>